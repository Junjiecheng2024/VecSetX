å¤§é¡¹ç›®åï¼šåŸºäºéšå¼ç¥ç»åœºçš„å¤šç±»å¿ƒè„ç»“æ„ å…³è”æ¨æ–­ ä¸ é²æ£’è¡¥å…¨ æ¡†æ¶

ï¼ˆå½“å‰ç¯å¢ƒæ˜¯æœ¬åœ°ç¯å¢ƒï¼Œå¯ä»¥ä¿®æ”¹ä»£ç ï¼Œæˆ‘é€šè¿‡GitHubæ‰‹åŠ¨åŒæ­¥åˆ°é›†ç¾¤ä¸Šï¼Œç„¶åæ‰‹åŠ¨åœ¨é›†ç¾¤ä¸Šè¿è¡Œã€‚æœ¬åœ°æ— æ•°æ®é›†ï¼Œæ‰€ä»¥ä¸èƒ½è¿è¡Œç»ˆç«¯å‘½ä»¤ã€‚ï¼‰
æˆ‘ä»¬ç°åœ¨æ­£åœ¨åšå¿ƒè„ç»“æ„çš„é‡å»ºä»»åŠ¡ï¼Œåˆ©ç”¨VecSetXæ¨¡å‹è¿›è¡Œå¿ƒè„ç»“æ„çš„é‡å»ºã€‚ä»¥ä¸‹ä¸ºè¯¦ç»†è¡ŒåŠ¨è®¡åˆ’ï¼š

è¡ŒåŠ¨è®¡åˆ’ï¼ˆAction Planï¼‰

é˜¶æ®µ 1ï¼šåŸºç¡€æ¨¡å‹è®­ç»ƒï¼ˆå¤šç±»é‡å»ºï¼‰
ç›®æ ‡ï¼šè®©æ¨¡å‹å…ˆå­¦ä¼šä»å®Œæ•´çš„ 10 ç±»ç»“æ„ä¸­è¿›è¡Œéšå¼è¡¨å¾ä¸é‡å»ºã€‚
æ­¥éª¤ï¼š
å°†æ¯ä¸ªç—…ä¾‹çš„ 10 ç±» segmentation mask è½¬æ¢ä¸ºé€‚ç”¨äº VecSetX çš„è¾“å…¥æ ¼å¼ï¼ˆç‚¹äº‘è¡¨ç¤ºï¼Œå¹¶é™„å¸¦ one-hot ç±»åˆ«ç¼–ç ï¼‰ã€‚
è®­ç»ƒ VecSetX çš„å¤šç±» autoencoderï¼Œä½¿æ¨¡å‹å®ç°â€œè¾“å…¥ 10 ç±»ç»“æ„ï¼Œè¾“å‡º 10 ç±»ç»“æ„â€çš„å®Œæ•´é‡å»ºã€‚
éªŒè¯æ¨¡å‹æ˜¯å¦èƒ½å¤Ÿç¨³å®šåœ°é‡å»ºå…¨å¿ƒç»“æ„ï¼Œç¡®ä¿ latent set ä¸ decoder å­¦ä¹ åˆ°äº†è¶³å¤Ÿçš„å¿ƒè„å½¢çŠ¶è¡¨è¾¾èƒ½åŠ›ã€‚
è¾“å‡ºï¼šä¸€ä¸ªèƒ½å¤Ÿç¨³å®šå¤„ç† 10 ç±»å…¨å¿ƒç»“æ„çš„ Encoder + Decoderï¼ˆéšå¼ç¥ç»åœºï¼‰ã€‚

é˜¶æ®µ 2ï¼šè¡¥å…¨ä»»åŠ¡è®­ç»ƒï¼ˆéƒ¨åˆ†è¾“å…¥ï¼Œå®Œæ•´è¾“å‡ºï¼‰
ç›®æ ‡ï¼šè®©æ¨¡å‹æŒæ¡ä»éƒ¨åˆ†ç»“æ„æ¨ç†å®Œæ•´å…¨å¿ƒç»“æ„çš„èƒ½åŠ›ã€‚
æ­¥éª¤ï¼š
åœ¨ç°æœ‰å®Œæ•´ 10 ç±»æ•°æ®é›†ä¸Šäººä¸ºæ„é€  partial masksï¼Œä¾‹å¦‚éšæœºç§»é™¤ 2 è‡³ 5 ä¸ªç±»ï¼Œæˆ–æŒ‰ç±»åˆ«è®¾è®¡ç‰¹å®šç¼ºå¤±æ–¹æ¡ˆã€‚
ä½¿ç”¨â€œè¾“å…¥éƒ¨åˆ†ç»“æ„ï¼Œè¾“å‡ºå®Œæ•´ç»“æ„â€çš„æ–¹å¼è®­ç»ƒæ¨¡å‹ï¼ˆpartial to fullï¼‰ã€‚
ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿæ ¹æ®è¾“å…¥çš„ incomplete å¿ƒè„å½¢çŠ¶æ¨ç†å‡ºç¼ºå¤±çš„ç»“æ„ã€‚
è¾“å‡ºï¼šå…·å¤‡è¡¥å…¨è¿‡ç¨‹èƒ½åŠ›çš„æ¨¡å‹ç‰ˆæœ¬ã€‚

åˆ›æ–°ç‚¹ A (Phase 2): æ¦‚ç‡è¡¥å…¨ (Probabilistic Completion)
æ ¸å¿ƒï¼šä¸æ˜¯è®­ç»ƒä¸€ä¸ªâ€œé‡å»ºå™¨â€ï¼Œè€Œæ˜¯è®­ç»ƒä¸€ä¸ªâ€œå½¢çŠ¶æ¨æ–­å™¨â€ã€‚
äº®ç‚¹ï¼šåˆ©ç”¨ Jitter å¢å¼ºçš„ SDF åœºï¼Œè®©æ¨¡å‹å­¦ä¼šäº†ä»æ®‹ç¼ºè¾“å…¥ï¼ˆPartial Inputï¼‰ä¸­â€œè„‘è¡¥â€å‡ºç¬¦åˆè§£å‰–å­¦è§„å¾‹çš„å®Œæ•´å¿ƒè„ã€‚è¿™è§£å†³äº†ä¸´åºŠä¸Šè¶…å£°/CTè§†é‡å—é™çš„é—®é¢˜ã€‚

é˜¶æ®µ 3ï¼šè·¨æ•°æ®é›†çŸ¥è¯†è¿ç§»ï¼ˆå¤©ç„¶æ®‹ç¼ºè¡¥å…¨ï¼‰
ç›®æ ‡ï¼šåˆ©ç”¨å¤šæ•°æ®é›†çš„"å¤©ç„¶æ®‹ç¼º"ç‰¹æ€§ï¼ŒéªŒè¯æ¨¡å‹çš„è·¨æ•°æ®é›†çŸ¥è¯†è¿ç§»å’Œå°‘æ ·æœ¬è¡¥å…¨èƒ½åŠ›ã€‚
æ ¸å¿ƒæ€æƒ³ï¼š
ç»§æ‰¿ Phase 2 çš„è¡¥å…¨èƒ½åŠ›ï¼Œä½†ä¸å†äººä¸ºä¸¢å¼ƒç±»åˆ«ã€‚
é›†æˆå¤šä¸ªå¼‚æ„æ•°æ®é›†ï¼ˆDataset Aï¼š10 ç±»åŸºç¡€é›†ï¼ŒDataset Bï¼šéƒ¨åˆ†é‡å  + æ–°å¢ç±»ï¼‰ï¼Œæ¯ä¸ªæ•°æ®é›†ç›¸å¯¹äºå…¨é›†éƒ½æ˜¯"å¤©ç„¶æ®‹ç¼º"çš„ã€‚
é€šè¿‡ Masked Loss ç­–ç•¥ï¼Œåœ¨åŒä¸€ Batch ä¸­æ··åˆè®­ç»ƒä¸åŒç±»åˆ«è¦†ç›–çš„æ•°æ®ï¼Œé¿å…æ ‡ç­¾å†²çªå’ŒçŸ¥è¯†é—å¿˜ã€‚
å…³é”®æŒ‘æˆ˜ï¼šæ•°æ®é‡å ä¸»å¯¼çš„ Dataset A èƒ½å¦æ¨æ–­å‡ºä»…åœ¨å°‘æ ·æœ¬ Dataset B ä¸­å‡ºç°çš„æ–°ç±»ï¼Ÿè¿™æ˜¯æ•°æ®ä¸å¹³è¡¡ä¸‹çš„å°‘æ ·æœ¬è¡¥å…¨é—®é¢˜ã€‚
è¾“å‡ºï¼šéªŒè¯è·¨æ•°æ®é›†è¡¥å…¨æ³›åŒ–èƒ½åŠ›ï¼Œä¸º Phase 4 çš„çœŸå®ä¸´åºŠæ®‹ç¼ºè¡¥å…¨æä¾›æ›´å…¨é¢çš„çŸ¥è¯†åº“ã€‚

åˆ›æ–°ç‚¹ B (Phase 3): è·¨æ•°æ®é›†çŸ¥è¯†è¿ç§» (Cross-Dataset Knowledge Transfer)
æ ¸å¿ƒï¼šåˆ©ç”¨å¼‚æ„æ•°æ®é›†çš„"å¤©ç„¶æ®‹ç¼º"ï¼Œæ— éœ€äººä¸ºæ„é€  Partial Inputã€‚
äº®ç‚¹ï¼šæµ‹è¯•æ¨¡å‹èƒ½å¦ä»ä¸€ä¸ªæ•°æ®é›†ï¼ˆå¦‚ Dataset Aï¼Œå  95% è®­ç»ƒæ•°æ®ï¼‰æ¨æ–­å‡ºä»…åœ¨å¦ä¸€ä¸ªå°æ ·æœ¬æ•°æ®é›†ï¼ˆDataset Bï¼Œå  5%ï¼‰ä¸­å‡ºç°çš„æ–°ç»“æ„ã€‚è¿™ä¸ä»…æ˜¯ç±»åˆ«æ‰©å±•ï¼Œæ›´æ˜¯éªŒè¯æ¨¡å‹åœ¨æ•°æ®ä¸å¹³è¡¡ã€å¼‚æ„æ ‡æ³¨åœºæ™¯ä¸‹çš„è¡¥å…¨é²æ£’æ€§ï¼Œä¸ºè·¨åŒ»ç–—ä¸­å¿ƒã€è·¨æˆåƒåè®®çš„å®é™…åº”ç”¨å¥ å®šåŸºç¡€ã€‚

é˜¶æ®µ 4ï¼šçœŸå® partial label å­¦ä¹ 
ç›®æ ‡ï¼šå°†è¡¥å…¨è¿‡ç¨‹æ¨å¹¿åˆ°çœŸå®åªæ ‡æ³¨éƒ¨åˆ†ç»“æ„çš„æ•°æ®ï¼Œä½¿æ¨¡å‹èƒ½åœ¨å®é™…åº”ç”¨ä¸­å®Œæˆå…¨å¿ƒè¡¥å…¨ã€‚
æ­¥éª¤ï¼š
æ”¶é›†çœŸå®çš„éƒ¨åˆ†æ ‡æ³¨æ•°æ®é›†åˆï¼ˆä¾‹å¦‚æŸäº›ç—…ä¾‹åªæ ‡æ³¨ 5 ç±»ã€æˆ–å¤–éƒ¨æ•°æ®é›†æ ‡æ³¨è¾ƒå°‘çš„ç»“æ„ï¼‰ã€‚
å°†è¿™äº›éƒ¨åˆ†æ ‡æ³¨ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡å‰é¢è®­ç»ƒè¿‡çš„æ¨¡å‹è¿›è¡Œè¡¥å…¨è®­ç»ƒæˆ–å¾®è°ƒã€‚
éªŒè¯æ¨¡å‹åœ¨çœŸå® partial label åœºæ™¯ä¸‹çš„è¡¥å…¨æ•ˆæœã€‚
è¾“å‡ºï¼šä¸€ä¸ªèƒ½åœ¨çœŸå®ä¸´åºŠæˆ–è·¨æ•°æ®é›†åœºæ™¯ä¸­ï¼Œè‡ªåŠ¨ä»éƒ¨åˆ†æ ‡æ³¨æ¨ç†å®Œæ•´å…¨å¿ƒç»“æ„çš„æ¨¡å‹ã€‚

åˆ›æ–°ç‚¹ C (Phase 4): çœŸå®åœºæ™¯é€‚é…
æ ¸å¿ƒï¼šä»äººå·¥æ„é€ çš„ Partial åˆ°çœŸå®çš„ Clinical Partialã€‚
äº®ç‚¹ï¼šéªŒè¯äº†æ–¹æ³•çš„å®æˆ˜ä»·å€¼ã€‚

æœ€ç»ˆç›®æ ‡
é€šè¿‡ä»¥ä¸Šå››ä¸ªé˜¶æ®µï¼Œæ„å»ºä¸€ä¸ªå…·å¤‡ä»¥ä¸‹èƒ½åŠ›çš„ç³»ç»Ÿï¼š
èƒ½è¡¨è¾¾å®Œæ•´ 10 ç±»å¿ƒè„ç»“æ„çš„éšå¼è¡¨å¾æ¨¡å‹ã€‚
èƒ½ä»ä¸å®Œæ•´ç»“æ„æ¢å¤å®Œæ•´å¿ƒè„ã€‚
èƒ½å¤„ç†è·¨æ•°æ®é›†ã€ä¸åŒç»“æ„å­é›†çš„è¾“å…¥ã€‚
èƒ½åœ¨çœŸå®éƒ¨åˆ†æ ‡æ³¨åœºæ™¯ä¸­å®ç°å…¨å¿ƒè¡¥å…¨ã€‚





---------------------------------------------------------------------------------
å½“å‰çŠ¶æ€
æ•°æ®ä¿®å¤å·²å®Œæˆï¼Œä¸”å…·æœ‰å®Œæ•´ 10 ç±» maskï¼Œå› æ­¤å¯ç›´æ¥å¼€å§‹é˜¶æ®µ 1ï¼ˆå¤šç±»é‡å»ºçš„ VecSetX è®­ç»ƒï¼‰ã€‚

å„ç±»åˆ«ï¼š
1 : Myocardium : The muscle tissue surrounding the left ventricle blood pool
2 : LA : The left atrium blood pool
3 : LV : The left ventricle blood pool including the papilary muscles and trabeculation
4 : RA : The right atrium blood pool
5 : RV : The right ventricle blood pool
6 : Aorta : The aorta including the aortic cusp
7 : PA : The pulmonary artery
8 : LAA : The left atrial appendage
9 : Coronary : The left and right coronary arteries
10 : PV : The pulmonary veins
11 : SVC : Superior Vena Cava
12 : IVC : Inferior Vena Cava
13 : CS : Coronary Sinus
14 : RVW : Right Ventricular Wall
15 : LAW : Left Atrial Wall
16 : PML : Posterior Mitral Leaflet


prepare_data.pyæ•°æ®å‡†å¤‡è„šæœ¬ (å¤„ç†æ‰€æœ‰æ ·æœ¬)ï¼ˆåŸå§‹æ•°æ®ä¸º .nii.gz æ ¼å¼çš„åŒ»å­¦åˆ†å‰²æ©ç ï¼Œè€Œ VecSetX æ¨¡å‹è®­ç»ƒéœ€è¦åŒ…å«ç‚¹äº‘ã€SDF å€¼å’Œè¡¨é¢æ³•å‘é‡ï¼ˆå¯é€‰ï¼‰çš„ .npz æ ¼å¼æ•°æ®ã€‚æ­¤å¤–ï¼ŒPhase 1 è¦æ±‚è¿›è¡Œå¤šç±»é‡å»ºï¼Œå› æ­¤éœ€è¦åœ¨æ•°æ®ä¸­åŒ…å«ç±»åˆ«ä¿¡æ¯ã€‚
ç½‘æ ¼æå–: ä½¿ç”¨ skimage.measure.marching_cubes ä»åˆ†å‰²æ©ç ä¸­æå– 3D ç½‘æ ¼ã€‚
è¡¨é¢é‡‡æ ·: å®ç°äº†åŸºäºç½‘æ ¼é¢ç§¯æƒé‡çš„è¡¨é¢ç‚¹é‡‡æ ·ï¼Œç¡®ä¿é‡‡æ ·ç‚¹å‡åŒ€åˆ†å¸ƒã€‚
ç±»åˆ«ç¼–ç : æå–äº† 10 ä¸ªè§£å‰–ç»“æ„çš„ç±»åˆ«æ ‡ç­¾ï¼Œå¹¶å¯¹è¡¨é¢ç‚¹è¿›è¡Œäº† One-hot ç¼–ç ã€‚ç”Ÿæˆçš„è¡¨é¢ç‚¹æ•°æ®ç»´åº¦ä¸º (N, 13)ï¼Œå…¶ä¸­å‰ 3 ç»´ä¸ºåæ ‡ï¼Œå 10 ç»´ä¸ºç±»åˆ«æ ‡ç­¾ã€‚
SDF è®¡ç®—: ä½¿ç”¨ trimesh å’Œ rtree (KDTree) è®¡ç®—ä½“ç§¯ç‚¹å’Œè¿‘è¡¨é¢ç‚¹çš„ç¬¦å·è·ç¦»å‡½æ•° (SDF) å€¼ã€‚ä¸ºäº†æé«˜é€Ÿåº¦ï¼Œä½¿ç”¨äº†æ³•å‘é‡è¿‘ä¼¼æ³•ã€‚
å½’ä¸€åŒ–: å°†æ‰€æœ‰ç‚¹åæ ‡å½’ä¸€åŒ–åˆ° [-1, 1] èŒƒå›´ï¼Œä¸æ¨¡å‹è¾“å…¥è¦æ±‚ä¸€è‡´ã€‚ï¼‰:
python vecset/prepare_data.py --input_dir /home/user/persistent/vecset/repaired_shape --output_dir /home/user/persistent/vecset/data_npz


create_csv.pyæ›´æ–°æ•°æ®é›† CSV æ–‡ä»¶: 
Objaverse æ•°æ®é›†åŠ è½½å™¨éœ€è¦ CSV æ–‡ä»¶æ¥ç´¢å¼•è®­ç»ƒå’ŒéªŒè¯æ•°æ®ã€‚
æ‰«ææ•°æ®ç›®å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆ train.csv å’Œ val.csvã€‚
æ•°æ®ç”Ÿæˆå®Œæˆåï¼Œè¯·è¿è¡Œæ­¤å‘½ä»¤ä»¥æ›´æ–° train.csv å’Œ val.csvï¼Œç¡®ä¿æ–°æ•°æ®è¢«åŒ…å«åœ¨å†…ï¼š
python create_csv.py

----------------------------------------------------------------------------
æ­£å¼è®­ç»ƒç¯å¢ƒï¼š
CPU count	128
Logical CPU count	256
GPU count	4
GPU type	NVIDIA A100-SXM4-40GB
Python version 3.12
OS Linux-4.18.0-553.74.1.el8_10.x86_64-x86_64-with-glibc2.28
MEM: 480Gi
----------------------------------------------------------------------------
é¡¹ç›®æ ¹ç›®å½•ï¼š
/projappl/project_2016517/JunjieCheng/VecSetX

ä½“ç´ æ•°æ®é›†ï¼š
/scratch/project_2016517/junjie/dataset/repaired_shape

ç‚¹äº‘æ•°æ®é›†ï¼šï¼ˆè®­ç»ƒç”¨æ•°æ®é›†ï¼‰
/scratch/project_2016517/junjie/dataset/repaired_npz
/scratch/project_2016517/junjie/dataset/dryad_npz
----------------------------------------------------------------------------
å•å¡æµ‹è¯•è¿›è¡Œä¸­ã€‚
å¾…å•å¡æµ‹è¯•å®Œæˆï¼Œè¿è¡Œæ­£å¼4å¡è®­ç»ƒã€‚
----------------------------------------------------------------------------
ğŸ“Š è®­ç»ƒæŒ‡æ ‡è¯¦è§£
ğŸ¯ æ ¸å¿ƒæŸå¤±æŒ‡æ ‡ï¼ˆLoss Metricsï¼‰
1. loss - æ€»æŸå¤±ï¼ˆæœ€é‡è¦çš„æŒ‡æ ‡ï¼‰
å½“å‰å€¼: ~987 (è®­ç»ƒ), ~911 (éªŒè¯)
å«ä¹‰: æ‰€æœ‰æŸå¤±é¡¹çš„åŠ æƒå’Œ
è®¡ç®—å…¬å¼: loss = loss_vol + 10 Ã— loss_near + 0.001 Ã— loss_eikonal + 1 Ã— loss_surface
æœŸæœ›: â¬‡ï¸ åº”è¯¥æŒç»­ä¸‹é™ï¼Œè¡¨æ˜æ¨¡å‹åœ¨å­¦ä¹ 
2. loss_vol - ä½“ç§¯ç‚¹ SDF æŸå¤±
å½“å‰å€¼: ~89.9 (è®­ç»ƒ), 0.0 (éªŒè¯ï¼Œå› ä¸ºéªŒè¯é›†æ²¡æœ‰ä½“ç§¯ç‚¹)
å«ä¹‰: æ¨¡å‹é¢„æµ‹çš„ä½“ç§¯å†…éƒ¨/å¤–éƒ¨ç‚¹çš„ SDF å€¼ä¸çœŸå®å€¼çš„å·®è·ï¼ˆL1è·ç¦»ï¼‰
æœŸæœ›: â¬‡ï¸ è¶Šå°è¶Šå¥½ï¼Œè¡¨ç¤ºä½“ç§¯é‡å»ºè¶Šå‡†ç¡®
3. loss_near - è¿‘è¡¨é¢ç‚¹ SDF æŸå¤± â­
å½“å‰å€¼: ~89.8 (è®­ç»ƒ), ~91.1 (éªŒè¯)
å«ä¹‰: æ¨¡å‹é¢„æµ‹çš„è¿‘è¡¨é¢ç‚¹çš„ SDF å€¼ä¸çœŸå®å€¼çš„å·®è·
é‡è¦æ€§: â­â­â­ æƒé‡ä¸º10ï¼Œæ˜¯æœ€é‡è¦çš„æŸå¤±é¡¹ï¼
æœŸæœ›: â¬‡ï¸ è¶Šå°è¶Šå¥½ï¼Œè¡¨ç¤ºè¡¨é¢é‡å»ºè¶Šç²¾ç¡®
4. loss_eikonal - Eikonal æ­£åˆ™åŒ–æŸå¤±
å½“å‰å€¼: ~0.9994
å«ä¹‰: SDF æ¢¯åº¦çš„èŒƒæ•°åº”è¯¥æ¥è¿‘1ï¼ˆæ•°å­¦çº¦æŸï¼‰
å…¬å¼: 
(||âˆ‡SDF|| - 1)Â²
æœŸæœ›: â‰ˆ 0ï¼Œå½“å‰éå¸¸æ¥è¿‘ç†æƒ³å€¼ï¼Œè¯´æ˜æ¢¯åº¦çº¦æŸè‰¯å¥½ âœ…
5. loss_surface - è¡¨é¢æŸå¤±
å½“å‰å€¼: ~0.001 (è®­ç»ƒ), ~0.0035 (éªŒè¯)
å«ä¹‰: è¡¨é¢ç‚¹çš„ SDF å€¼åº”è¯¥ä¸º 0ï¼ˆå› ä¸ºå®ƒä»¬åœ¨è¡¨é¢ä¸Šï¼‰
æœŸæœ›: â¬‡ï¸ è¶Šå°è¶Šå¥½ï¼Œå½“å‰å·²ç»å¾ˆå° âœ…
ğŸ“ è´¨é‡è¯„ä¼°æŒ‡æ ‡ï¼ˆIoU Metricsï¼‰
6. vol_iou & near_iou - äº¤å¹¶æ¯”
å½“å‰å€¼: 0.0000 ğŸ˜Ÿ
å«ä¹‰: é¢„æµ‹çš„å ç”¨ç½‘æ ¼ä¸çœŸå®å ç”¨ç½‘æ ¼çš„é‡å åº¦
èŒƒå›´: 0.0 ~ 1.0ï¼ˆ1.0 è¡¨ç¤ºå®Œç¾åŒ¹é…ï¼‰
é—®é¢˜: âš ï¸ IoU ä¸º 0 è¯´æ˜æ¨¡å‹è¿˜æ²¡æœ‰å­¦åˆ°ä»»ä½•æœ‰æ„ä¹‰çš„å½¢çŠ¶ï¼
åŸå› :
Epoch 0-1 åˆšå¼€å§‹è®­ç»ƒï¼Œæ¨¡å‹æƒé‡æ˜¯éšæœºåˆå§‹åŒ–çš„
éœ€è¦æ›´å¤šè½®æ¬¡è®­ç»ƒæ‰èƒ½æ”¶æ•›
7. 
iou
 - ç»¼åˆ IoU â­â­â­
å…¬å¼: 
(vol_iou + near_iou) / 2
é‡è¦æ€§: æœ€é‡è¦çš„è´¨é‡æŒ‡æ ‡ï¼
æœŸæœ›: â¬†ï¸ åº”è¯¥é€æ¸ä¸Šå‡ï¼Œç›®æ ‡è‡³å°‘ 0.5+

æ‚¨åº”è¯¥é‡ç‚¹å…³æ³¨ä»€ä¹ˆï¼Ÿ
ä¼˜å…ˆçº§ 1ï¸âƒ£ï¼šè´¨é‡æŒ‡æ ‡
âœ… ä¸»è¦çœ‹éªŒè¯é›†çš„ iou (å½“å‰: 0.000)
   - ç›®æ ‡: ç¬¬10ä¸ªepochåº”è¯¥ > 0.1
   - ç›®æ ‡: ç¬¬50ä¸ªepochåº”è¯¥ > 0.3
   - ç›®æ ‡: ç¬¬200ä¸ªepochåº”è¯¥ > 0.5
ä¼˜å…ˆçº§ 2ï¸âƒ£ï¼šæŸå¤±è¶‹åŠ¿
âœ… loss_near (éªŒè¯é›†ï¼Œå½“å‰: ~91)
   - åº”è¯¥æŒç»­ä¸‹é™
   - å¦‚æœä¸ä¸‹é™æˆ–éœ‡è¡ï¼Œè¯´æ˜æœ‰é—®é¢˜

âœ… loss (æ€»æŸå¤±ï¼Œå½“å‰: ~987è®­ç»ƒ, ~911éªŒè¯)
   - åº”è¯¥æŒç»­ä¸‹é™
   - éªŒè¯lossåº”è¯¥æ¥è¿‘è®­ç»ƒloss
ä¼˜å…ˆçº§ 3ï¸âƒ£ï¼šè¿‡æ‹Ÿåˆæ£€æµ‹
âš ï¸ å¯¹æ¯”è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„ loss:
   - è®­ç»ƒ: 987
   - éªŒè¯: 911
   - å½“å‰éªŒè¯lossæ›´ä½ï¼Œè¿™å¾ˆæ­£å¸¸ï¼ˆéªŒè¯é›†åªç”¨near pointsï¼‰
   - å¦‚æœåç»­è®­ç»ƒlossè¿œä½äºéªŒè¯loss â†’ è¿‡æ‹Ÿåˆ
ä¼˜å…ˆçº§ 4ï¸âƒ£ï¼šç³»ç»Ÿç¨³å®šæ€§
âœ… loss_eikonal â‰ˆ 1.0 (å½“å‰: 0.9994) âœ“ æ­£å¸¸
âœ… max mem < 40000 MB âœ“ æ˜¾å­˜å……è¶³
âœ… time ç¨³å®š âœ“ æ²¡æœ‰å†…å­˜æ³„æ¼
--------------------------------------------------------------------
å¯¹äºâ€œæ ‡å‡†åŒ–æŒ‡æ ‡â€ï¼ˆå°¤å…¶æ˜¯åœ¨è®ºæ–‡ä¸­ï¼‰ï¼Œæ‚¨åº”è¯¥å…³æ³¨ä»¥ä¸‹æŒ‡æ ‡ï¼š

IoUï¼ˆäº¤å¹¶æ¯”ï¼‰ï¼š

å®šä¹‰ï¼šé‡å»ºç»“æœä¸çœŸå®å€¼ä¹‹é—´çš„ä½“ç§¯é‡å åº¦ã€‚

è·å–æ–¹å¼ï¼šæ‚¨çš„è®­ç»ƒæ—¥å¿—ä¸­å·²æœ‰ test_iouï¼ˆæˆ– test_vol_iouï¼‰ã€‚

æ ‡å‡†ï¼šå¯¹äºåŒ»å­¦å™¨å®˜é‡å»ºï¼Œ> 0.85 ä¸ºä¼˜ç§€ï¼Œ> 0.7 ä¸ºå¯æ¥å—ã€‚

Dice ç³»æ•° (DSC)ï¼š

å®šä¹‰ï¼šåœ¨åŒ»å­¦æˆåƒä¸­éå¸¸å¸¸è§ã€‚Dice = 2 * IoU / (1 + IoU)ã€‚

æ ‡å‡†ï¼šå¯¹äºä¸»è¦å™¨å®˜ï¼ˆå·¦å¿ƒå®¤/å³å¿ƒå®¤ï¼‰ï¼Œé€šå¸¸ç›®æ ‡å€¼ä¸º > 0.90ï¼›å¯¹äºè¾ƒå°çš„è¡€ç®¡ï¼Œç›®æ ‡å€¼ä¸º > 0.80ã€‚

åœ¨è®ºæ–‡ä¸­éœ€è¦å†™ï¼šå€’è§’è·ç¦» (CD)ï¼š
Chamfer Distance (CD):
What it is: Calculated on the surface mesh (extracted via infer.py). It measures the average distance from points on your predicted heart surface to the nearest point on the real heart surface.
Standard: The lower the better. Usually measured in millimeters (mm).
-----------------------------------------------------------------------------------
VecSetX çš„å·¥ä½œæµç¨‹
è®­ç»ƒæ—¶ï¼ˆè®­ç»ƒé›†æ ·æœ¬ï¼‰

# 1. è¾“å…¥: è¡¨é¢ç‚¹äº‘ (8192 Ã— 13)
surface = sample_1_surface_points  # shape: (8192, 13)

# 2. Encoder: ç‚¹äº‘ â†’ latent set
latent_set = encoder(surface)  # shape: (16, 1024)
# è¿™ 16 ä¸ªå‘é‡æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸æ˜¯é¢„å­˜çš„ï¼

# 3. Decoder: latent set + æŸ¥è¯¢ç‚¹ â†’ SDF
query_points = [vol_points + near_points]  # shape: (2048, 3)
sdf_pred = decoder(latent_set, query_points)  # shape: (2048,)

# 4. è®¡ç®— loss
loss = L1(sdf_pred, sdf_true)

# 5. åå‘ä¼ æ’­æ›´æ–° Encoder å’Œ Decoder çš„å‚æ•°
optimizer.step()
éªŒè¯æ—¶ï¼ˆéªŒè¯é›†æ ·æœ¬ï¼‰

# å®Œå…¨ç›¸åŒçš„æµç¨‹ï¼
surface = val_sample_surface_points  # æ–°æ ·æœ¬

latent_set = encoder(surface)  # â† Encoder å¯ä»¥å¤„ç†æ–°æ ·æœ¬ï¼
sdf_pred = decoder(latent_set, query_points)
iou = calc_iou(sdf_pred, sdf_true)
å…³é”®ï¼šEncoder æ˜¯ä¸€ä¸ªå¯æ³›åŒ–çš„ç¥ç»ç½‘ç»œï¼Œä¸æ˜¯æŸ¥è¡¨æ“ä½œï¼


å®Œæ•´çš„å½¢çŠ¶ç»´åº¦

# è¾“å…¥
surface_points: (Batch, 8192, 13)
               # 8192 ä¸ªç‚¹ï¼Œæ¯ä¸ªç‚¹ 3D åæ ‡ + 10 ç±» one-hot

# Encoder è¾“å‡º
latent_set: (Batch, 16, 1024)
           # 16 ä¸ª latent vectorsï¼Œæ¯ä¸ª 1024 ç»´

# Decoder è¾“å…¥
query_points: (Batch, 2048, 3)
             # 2048 ä¸ªæŸ¥è¯¢ç‚¹ (vol + near)
latent_set: (Batch, 16, 1024)  # é‡å¤ä½¿ç”¨

# Decoder è¾“å‡º
sdf_predictions: (Batch, 2048)
                # 2048 ä¸ª SDF å€¼

ç”¨ 16 ä¸ªä¸“å®¶çš„ 1024 ç»´æŠ¥å‘Š æ¥æ€»ç»“ä¸€ä¸ªå¿ƒè„çš„å®Œæ•´å½¢çŠ¶
---------------------------------------------------------------------------
è®­ç»ƒåå‘ç°æ•°æ®é›†æœ‰é—®é¢˜ï¼Œè°ƒæ•´æ•°æ®é›†çš„è®¡ç®—ã€‚

å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œtest_vol_iou	æ’ç­‰äº0.
è°ƒæ•´æ•°æ®é›†åå‘ç°è®­ç»ƒè¿˜æ˜¯åœæ»ï¼Œæ”¹ç”¨run_phase1_sbatch_v2.shï¼Œè°ƒé«˜äº†å­¦ä¹ ç‡ã€‚

ä¿®æ”¹äº†æ•°æ®çš„ç”Ÿæˆæ–¹å¼ï¼Œç°åœ¨é‡å¯è®­ç»ƒã€‚
ç°åœ¨çš„æ•°æ®é›†è´¨é‡ï¼š
((junjieenv) ) [chengjun@g2201 VecSetX]$ python check_data_quality.py /scratch/project_2016517/j
unjie/dataset/repaired_npz
ğŸ“Š SDF Balance (Vol Positive %)
  Mean:   45.1%
  Std:    0.6%
  Range:  [43.0%, 46.8%]

ğŸ“Š SDF Balance (Near Positive %)
  Mean:   44.1%
  Std:    0.9%
  Range:  [41.1%, 46.6%]

âœ… Label Consistency
  Mean:   100.0%
  Std:    0.0%
  Range:  [100.0%, 100.0%]

ğŸ“‹ Class Coverage Distribution
  9 classes: 1 files (0.1%)
  10 classes: 997 files (99.9%)

è®­ç»ƒäº†æ¨¡å‹åå‘ç°è¿˜æ˜¯æ•°æ®é›†æœ‰é—®é¢˜ã€‚
å†é‡æ–°ç”Ÿæˆæ•°æ®é›†ã€‚


python prepare_data.py \
   --input_dir /scratch/project_2016517/junjie/dataset/repaired_shape \
   --output_dir /scratch/project_2016517/junjie/dataset/repaired_npz \
   --num_surface_points 100000 \
   --num_vol_points 100000 \
   --classes 10 \
   --batch_size 5000 \
   --start_idx 0 \
   --end_idx 1


python check_data_visualize.py \
   --index 0 \
   --npz_dir /scratch/project_2016517/junjie/dataset/repaired_npz \
   --gt_dir /scratch/project_2016517/junjie/dataset/repaired_shape \
   --output_dir data_check_vis \
   --axis 2


python check_data_quality.py /scratch/project_2016517/junjie/dataset/repaired_npz


æ”¹äº†æ•°æ®é›†ç”Ÿæˆæ–¹å¼ï¼Œç°åœ¨é‡æ–°ç”Ÿæˆç‚¹äº‘æ•°æ®é›†

æ‰¾åˆ°ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼šDryad

åº”ç”¨æ–°æ”¹è¿›çš„æ•°æ®é›†ï¼ˆæ¯ç±»å…ˆé‡‡æ ·2000ä¸ªç‚¹ï¼Œå†æŒ‰é¢ç§¯å‡åŒ€é‡‡æ ·ï¼‰ï¼Œè®­ç»ƒåå‘ç°æ•ˆæœå‡ ä¹æ²¡æœ‰åŒºåˆ«ã€‚
åº”ç”¨æ–°çš„è®­ç»ƒç­–ç•¥ï¼š1.è®­ç»ƒæ—¶ä¹ŸæŒ‰ç±»åˆ«é‡‡æ ·ã€‚2.Focal BCE Losså¢åŠ gammaè‡³2.0ï¼Œæé«˜éš¾åˆ†ç±»ç‚¹çš„æƒé‡ã€‚3.å¢åŠ 6ï¼Œ7ï¼Œ9ï¼Œ10ç±»çš„æƒé‡ã€‚

ç°åœ¨p1ï¼Œp2ï¼Œp3æ­£åœ¨å¹¶è¡Œè®­ç»ƒä¸­